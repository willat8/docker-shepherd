#!/bin/bash

#curl -LO https://github.com/multiarch/qemu-user-static/releases/download/v6.1.0-5/qemu-aarch64-static
#chmod +x qemu-aarch64-static
#docker run --rm --privileged multiarch/qemu-user-static:register --reset

#docker buildx create --use --name arm64-builder --driver docker
#docker buildx build --platform linux/arm64 -f "${DOCKERFILE_PATH:-Dockerfile}.arm64" -t "$IMAGE_NAME" .

# As per https://docs.docker.com/engine/reference/commandline/buildx_build/#allow
docker buildx create --use --name insecure-builder --buildkitd-flags '--allow-insecure-entitlement security.insecure'
docker buildx build --allow security.insecure --output type=image,name=$IMAGE_NAME,push-by-digest=true -f "${DOCKERFILE_PATH:-Dockerfile}" .

